# ==============================================
# BikeDreams Backend - Redis Staging Configuration
# ==============================================
# This file contains staging-specific Redis configurations
# optimized for testing and pre-production environments.

# ==============================================
# Network Configuration
# ==============================================
# Bind to all interfaces for staging
bind 0.0.0.0

# Port configuration
port 6379

# TCP keepalive
tcp-keepalive 300

# ==============================================
# General Configuration
# ==============================================
# Daemonize (handled by Docker)
daemonize no

# PID file
pidfile /var/run/redis_6379.pid

# Log level (notice for staging)
loglevel notice

# Log file
logfile ""

# Database count
databases 16

# ==============================================
# Memory Management
# ==============================================
# Maximum memory usage (1GB for staging)
maxmemory 1gb

# Memory eviction policy (allkeys-lru for staging)
maxmemory-policy allkeys-lru

# ==============================================
# Persistence Configuration
# ==============================================
# RDB persistence (enabled for staging)
save 900 1
save 300 10
save 60 1000

# RDB file
dbfilename dump.rdb

# RDB directory
dir /data

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# AOF persistence (enabled for staging)
appendonly yes

# AOF file
appendfilename "appendonly.aof"

# AOF sync policy (everysec for staging)
appendfsync everysec

# AOF rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ==============================================
# Security Configuration
# ==============================================
# Password (staging password)
requirepass staging_redis_password

# Disable dangerous commands in staging
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_9a2b3c4d5e6f7g8h"

# ==============================================
# Client Configuration
# ==============================================
# Maximum number of clients
maxclients 2000

# Client timeout
timeout 300

# ==============================================
# Slow Log Configuration
# ==============================================
# Slow log threshold (50ms for staging)
slowlog-log-slower-than 50000

# Slow log max length
slowlog-max-len 256

# ==============================================
# Latency Monitoring
# ==============================================
# Latency monitoring threshold
latency-monitor-threshold 50

# ==============================================
# Advanced Configuration
# ==============================================
# Hash configuration
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List configuration
list-max-ziplist-size -2
list-compress-depth 0

# Set configuration
set-max-intset-entries 512

# Sorted set configuration
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog configuration
hll-sparse-max-bytes 3000

# Streams configuration
stream-node-max-bytes 4096
stream-node-max-entries 100

# ==============================================
# Staging-Specific Settings
# ==============================================
# Enable keyspace notifications
notify-keyspace-events Ex

# Enable command tracking
tracking-table-max-keys 1000000

# Enable client tracking
client-tracking yes

# ==============================================
# Logging Configuration
# ==============================================
# Log queries
log-queries yes

# Log slow queries
log-slow-queries yes

# ==============================================
# Staging Tools
# ==============================================
# Enable Redis modules (if needed)
# loadmodule /path/to/module.so

# ==============================================
# Monitoring Configuration
# ==============================================
# Enable monitoring
monitor-threshold 500

# ==============================================
# Performance Tuning
# ==============================================
# TCP backlog
tcp-backlog 511

# Unix socket
unixsocket /tmp/redis.sock
unixsocketperm 700

# ==============================================
# Replication Configuration (if applicable)
# ==============================================
# Master configuration
# replicaof <masterip> <masterport>
# masterauth <master-password>

# ==============================================
# Staging Comments
# ==============================================
# This configuration is optimized for staging:
# - Balanced logging for monitoring
# - Moderate memory limits for testing
# - Persistence enabled for data safety
# - Dangerous commands disabled for safety
# - Monitoring enabled for performance analysis
# - Performance tuned for testing scenarios
