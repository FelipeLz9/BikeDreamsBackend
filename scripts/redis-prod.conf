# ==============================================
# BikeDreams Backend - Redis Production Configuration
# ==============================================
# This file contains production-specific Redis configurations
# optimized for high performance and security.

# ==============================================
# Network Configuration
# ==============================================
# Bind to specific interface for production
bind 127.0.0.1

# Port configuration
port 6379

# TCP keepalive
tcp-keepalive 300

# ==============================================
# General Configuration
# ==============================================
# Daemonize (handled by Docker)
daemonize no

# PID file
pidfile /var/run/redis_6379.pid

# Log level (warning for production)
loglevel warning

# Log file
logfile ""

# Database count
databases 16

# ==============================================
# Memory Management
# ==============================================
# Maximum memory usage (2GB for production)
maxmemory 2gb

# Memory eviction policy (volatile-ttl for production)
maxmemory-policy volatile-ttl

# ==============================================
# Persistence Configuration
# ==============================================
# RDB persistence (enabled for production)
save 900 1
save 300 10
save 60 10000

# RDB file
dbfilename dump.rdb

# RDB directory
dir /data

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# AOF persistence (enabled for production)
appendonly yes

# AOF file
appendfilename "appendonly.aof"

# AOF sync policy (everysec for production)
appendfsync everysec

# AOF rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ==============================================
# Security Configuration
# ==============================================
# Password (production password)
requirepass production_redis_password

# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_9a2b3c4d5e6f7g8h"
rename-command DEBUG ""
rename-command EVAL "EVAL_9a2b3c4d5e6f7g8h"

# ==============================================
# Client Configuration
# ==============================================
# Maximum number of clients
maxclients 5000

# Client timeout
timeout 300

# ==============================================
# Slow Log Configuration
# ==============================================
# Slow log threshold (10ms for production)
slowlog-log-slower-than 10000

# Slow log max length
slowlog-max-len 512

# ==============================================
# Latency Monitoring
# ==============================================
# Latency monitoring threshold
latency-monitor-threshold 10

# ==============================================
# Advanced Configuration
# ==============================================
# Hash configuration
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List configuration
list-max-ziplist-size -2
list-compress-depth 0

# Set configuration
set-max-intset-entries 512

# Sorted set configuration
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog configuration
hll-sparse-max-bytes 3000

# Streams configuration
stream-node-max-bytes 4096
stream-node-max-entries 100

# ==============================================
# Production-Specific Settings
# ==============================================
# Enable keyspace notifications
notify-keyspace-events Ex

# Enable command tracking
tracking-table-max-keys 1000000

# Enable client tracking
client-tracking yes

# ==============================================
# Logging Configuration
# ==============================================
# Log queries (disabled for production)
log-queries no

# Log slow queries
log-slow-queries yes

# ==============================================
# Production Tools
# ==============================================
# Enable Redis modules (if needed)
# loadmodule /path/to/module.so

# ==============================================
# Monitoring Configuration
# ==============================================
# Enable monitoring
monitor-threshold 100

# ==============================================
# Performance Tuning
# ==============================================
# TCP backlog
tcp-backlog 511

# Unix socket
unixsocket /tmp/redis.sock
unixsocketperm 700

# ==============================================
# Replication Configuration (if applicable)
# ==============================================
# Master configuration
# replicaof <masterip> <masterport>
# masterauth <master-password>

# ==============================================
# Security Hardening
# ==============================================
# Disable protected mode
protected-mode yes

# ==============================================
# Production Comments
# ==============================================
# This configuration is optimized for production:
# - Minimal logging for performance
# - High memory limits for production load
# - Persistence enabled for data safety
# - All dangerous commands disabled for security
# - Monitoring enabled for performance analysis
# - Performance tuned for production scenarios
# - Security hardened for production use
